# Project Phases

Toronto Urban Mobility Analytics implementation roadmap. Phases are sequenced by technical dependency. Each phase produces shippable artifacts that unlock subsequent work.

| ID    | Phase                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ----- | --------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| PH-01 | Repository Governance Foundation [COMPLETE]   | Establish deterministic repository governance including CLAUDE.md enforcement, Claude skills framework (python-writing, dbt-model, skill-creator), Protocol Zero automation, and pre-commit hook infrastructure. Configure GitHub branch protection, required status checks (5 workflows), and CODEOWNER policies. Guarantees code quality invariants before feature development begins. Enables safe multi-contributor scaling with automated compliance gates.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| PH-02 | Snowflake & dbt Environment Setup [COMPLETE]  | Provision Snowflake Enterprise trial account with TORONTO_MOBILITY database. Create schema hierarchy (RAW, STAGING, INTERMEDIATE, MARTS, SEEDS) and role-based access control (LOADER_ROLE, TRANSFORMER_ROLE) per security model. Initialize dbt Core 1.8+ project with packages.yml (dbt-utils, dbt-expectations, elementary pinned versions), profiles.yml.example template, and custom macros (generate_schema_name, get_date_spine). Exit criterion: `dbt debug` returns all green checks against Snowflake target.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| PH-03 | Data Ingestion Pipeline [COMPLETE]            | Implement Python 3.12 ingestion scripts under `/scripts` following atomic transaction semantics. Build download.py (fetch from Toronto Open Data Portal), validate.py (schema contract enforcement with fail-fast behavior per Section 4.3 data contracts), transform.py (XLSX to CSV conversion), and load.py (Snowflake COPY INTO with MERGE idempotency). Execute initial load for TTC delays (subway/bus/streetcar), Bike Share ridership, and weather data spanning 2019-present. Exit criterion: RAW schema tables populated with row counts validated against source files within 1% tolerance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| PH-04 | Seed Data Layer [COMPLETE]                    | Curate reference data seeds required for downstream transformations. Build ttc_station_mapping.csv (raw station name variants mapped to canonical station_key, resolving historical inconsistencies), ttc_delay_codes.csv (code to description to category mapping), and bike_station_ref.csv (station_id, coordinates, neighborhood from GBFS snapshot). Generate dim_date seed covering 2019-01-01 through 2026-12-31 date spine. Document all seeds in \_seeds.yml with column descriptions. Exit criterion: `dbt seed` executes successfully with all reference data loaded to SEEDS schema.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| PH-05 | Staging Layer [COMPLETE]                      | Implement staging models as views in `/models/staging` following medallion architecture layer one. Create stg_ttc_subway_delays, stg_ttc_bus_delays, stg_ttc_streetcar_delays, stg_bike_trips (with duration >= 60s filter), and stg_weather_daily. Apply standardized transformations: type casting, column renaming to snake_case, null handling, and surrogate key generation via dbt_utils.generate_surrogate_key(). Define sources in \_sources.yml with freshness checks (warn_after: 45 days, error_after: 90 days). Exit criterion: `dbt build --select staging` passes with all tests green.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| PH-06 | Intermediate Layer [COMPLETE]                 | Build intermediate models as ephemeral CTEs in `/models/intermediate` implementing business logic transformations. Create int_ttc_delays_unioned (union all transit modes with mode identifier), int_ttc_delays_enriched (join delay codes, map station names via seed), int_bike_trips_enriched (add station geography, compute duration buckets), int_daily_transit_metrics (pre-aggregate delays to daily grain), and int_daily_bike_metrics (pre-aggregate trips to daily grain). Implement station mapping coverage test targeting >= 99% match rate. Exit criterion: `dbt build --select intermediate` passes with station mapping coverage validated.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| PH-07 | Marts Layer [COMPLETE]                        | Construct final analytics-ready models as tables in `/models/marts` per medallion architecture layer three. Build dimension tables: dim_date (generated spine with time intelligence attributes), dim_station (unified TTC + Bike Share with SCD Type 1), dim_weather (daily weather with condition classification), dim_ttc_delay_codes (code lookup with category). Build fact tables: fct_transit_delays (one row per incident, ~1.8M rows), fct_bike_trips (one row per trip, ~30M rows), fct_daily_mobility (cross-modal daily aggregates, ~2,200 rows). Implement comprehensive tests: unique/not_null on all PKs, relationships on all FKs, accepted_values on categoricals. Exit criterion: `dbt build --select marts` passes with 100% PK coverage and all FK relationships valid.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| PH-08 | Testing & Quality Assurance [COMPLETE]        | Implement production-grade test coverage beyond schema tests. Create singular tests in `/tests`: assert_no_negative_delays, assert_bike_trips_reasonable_duration (< 24 hours), assert_no_future_dates, assert_daily_row_count_stability (no > 50% day-over-day drop), assert_station_mapping_coverage. Add dbt_expectations tests for value distributions (delay_minutes between 0-1440, trip_duration bounds). Configure Elementary anomaly detection (volume_anomalies, freshness_anomalies, schema_changes) on all mart models. Execute full regression with `dbt test` achieving 100% pass rate. Exit criterion: Zero test failures, Elementary baseline established, test strategy documented in docs/TESTS.md.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| PH-09 | Documentation & Observability [COMPLETE]      | Complete model documentation and observability infrastructure. Write column-level descriptions for all models in corresponding \_models.yml files. Generate dbt docs site with `dbt docs generate` and verify lineage graph accuracy. Configure Elementary report generation and integrate with CI pipeline (edr report). Document all architectural decisions, testing strategy, and operational runbooks. Validate query performance against benchmark suite (5 queries < 5 seconds on X-Small warehouse). Exit criterion: `dbt docs generate` succeeds with zero missing descriptions, Elementary dashboard operational, performance benchmarks documented.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| PH-10 | Portfolio Delivery [COMPLETE]                 | Finalize repository for public portfolio presentation. Complete README.md with architecture diagrams (system overview, data flow, ER diagram), setup instructions (Snowflake provisioning, dbt configuration, initial load), and executable sample queries. Move sample queries to `/analyses` folder with linting compliance. Execute final code review against CLAUDE.md Definition of Done checklist. Verify all CI status checks pass on main branch. Tag v1.0.0 release with changelog. Exit criterion: README complete, CI green, all governance checks pass, repository production-ready for portfolio demonstration.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| PH-11 | Dashboard Foundation & Data Access Layer [COMPLETE] | Scaffold the multi-page Streamlit application under `/dashboard` following the project structure defined in dashboard design document Section 5.2. Create `app.py` entry point with page routing, `/pages` directory for 5 page modules, `/components` for reusable UI factories (metrics, charts, maps, filters), `/data` for connection management and query definitions, `/styles` for custom CSS, and `.streamlit/config.toml` for theme configuration. Implement Snowflake connection manager using `st.cache_resource` with secrets-based credential management (account, user, password, warehouse, database, role) targeting MARTS schema exclusively. Build parameterized SQL query layer covering all 7 MARTS tables: fct_transit_delays, fct_bike_trips, fct_daily_mobility, dim_station, dim_date, dim_weather, dim_ttc_delay_codes. Configure tiered caching strategy via `st.cache_data`: reference data at 24-hour TTL, hero aggregations at 1-hour TTL, standard aggregations at 30-minute TTL, filtered queries at 10-minute TTL. Establish design system: custom CSS with project color palette (TTC red #DA291C, Bike Share green #43B02A, neutral slate #334155, background off-white #FAFAFA, accent blue #2563EB), Inter and JetBrains Mono typography, and Altair chart theme registration. Build reusable component library: metric card factory, sidebar filter components, and chart builder functions. Implement Overview landing page (Page 1) with 4 hero metrics (Total Delay Hours, Total Bike Trips, Worst Station, Data Freshness), year-over-year trend sparkline sourced from fct_daily_mobility, and transit mode comparison bar chart. Excludes: drill-down pages (TTC Deep Dive, Bike Share, Weather Impact, Station Explorer), PyDeck map visualizations, Plotly treemaps, mobile-specific layout overrides, and Streamlit Community Cloud deployment. Entry criterion: PH-07 MARTS layer operational with all 7 dimension and fact tables populated and passing schema tests. Exit criterion: `streamlit run dashboard/app.py` renders Overview page with live Snowflake data, hero metrics load within 3 seconds, design system applied consistently across all components, and `secrets.toml.example` committed with zero credentials exposed.                                                                                                |
| PH-12 | Transit Analytics Visualization [COMPLETE]    | Implement TTC Deep Dive page (`pages/2_TTC_Deep_Dive.py`) with full interactivity per dashboard design document Section 4.2 Page 2 specification. Build reusable sidebar filter components: date range selector (`st.date_input`, default all-time range), transit mode multiselect (`st.multiselect` for subway, bus, streetcar). Implement 5 visualization types: worst stations horizontal bar chart (Altair, top 10 by delay minutes from fct_transit_delays joined to dim_station), delay causes treemap (Plotly, category-to-code hierarchy from dim_ttc_delay_codes), hour-of-day by day-of-week heatmap (Altair, from fct_transit_delays temporal fields), year-over-year monthly trend line chart (monthly aggregates from fct_transit_delays), and worst stations map (PyDeck ScatterplotLayer with red gradient using dim_station latitude/longitude coordinates joined to delay aggregates). Enable cross-filtering: date range and transit mode filters propagate to all chart components within the page. Surface contextual insight annotations: Bloor-Yonge delay share percentage, Operations category dominance (47.5%), peak delay time windows (Friday 3-5 PM), and YoY trend direction (+17% since 2020). Excludes: Bike Share Deep Dive page, Weather Impact page, Station Explorer page, mobile-specific layout adjustments, and Streamlit Community Cloud deployment. Entry criterion: PH-11 foundation complete with working Overview page, validated Snowflake connection, and reusable component library available. Exit criterion: TTC Deep Dive page renders all 5 chart types with live MARTS data, filter interactions respond within 2 seconds, PyDeck map renders 75 subway stations with delay-proportional sizing, and all queries execute against MARTS layer without full table scans on fct_bike_trips.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| PH-13 | Bike Share & Weather Analytics                | Implement Bike Share Deep Dive page (`pages/3_Bike_Share.py`) per dashboard design document Section 4.2 Page 3: date range filter, user type multiselect (Annual/Casual), station activity heatmap (PyDeck HeatmapLayer with green gradient over 1,009 Bike Share stations from dim_station), yearly growth area chart, member versus casual stacked bar chart, multi-year seasonality overlay with all years by month, and top 20 start stations sortable table (`st.dataframe`). Implement Weather Impact page (`pages/4_Weather_Impact.py`) per dashboard design document Section 4.2 Page 4: weather condition filter (`st.selectbox` for Clear/Rain/Snow from dim_weather), bike trips by weather bar chart, transit delays by weather bar chart, temperature versus daily trips scatter plot, precipitation versus daily trips scatter plot, and key callout boxes (`st.info`) with computed weather impact comparisons (rain reduces bike trips by 55%, snow increases TTC delays by 8%, temperature sweet spot 15-25°C). All Bike Share queries MUST use pre-aggregated data from fct_daily_mobility or bounded GROUP BY with date_key partition pruning — no unbounded scans of fct_bike_trips (21.8M rows). Both pages source from MARTS tables joined through dim_date and dim_weather for temporal alignment. Excludes: Station Explorer page, cross-page click-through navigation, mobile-specific layout overrides, Streamlit Community Cloud deployment, RAG text-to-SQL integration, and predictive analytics. Entry criterion: PH-12 TTC Deep Dive page complete with validated filter components, chart factory functions, and PyDeck map integration operational. Exit criterion: Bike Share page renders 6 visualization types with PyDeck heatmap supporting 1,000+ station points under 2 seconds, Weather page renders 4 chart types with scatter plots at daily granularity, and all queries return within the 2-second interaction performance target.                                                                                                                                                                                                                                                                                                                                                                                                         |
| PH-14 | Station Explorer, Deployment & Demo Readiness | Implement Station Explorer page (`pages/5_Station_Explorer.py`) per dashboard design document Section 4.2 Page 5: searchable station selector (`st.selectbox` with search across 1,084 stations), station type toggle (`st.radio` for TTC/Bike Share), centered PyDeck map on selected station, conditional detail charts (delay timeline for TTC stations from fct_transit_delays, trip timeline for Bike Share stations from fct_bike_trips), station summary metric cards, and nearby stations table by geographic proximity. Execute cross-page UX polish: consistent sidebar filter behavior across all 5 pages, smooth page transitions, and responsive layout adjustments ensuring all charts remain readable on mobile viewports. Validate performance against all dashboard design document Section 5.6 targets: cold start under 5 seconds, warm page navigation under 1 second, filter interaction response under 2 seconds, map render under 2 seconds for 1,000+ points. Verify Snowflake cost controls: caching prevents redundant queries across page navigations, TRANSFORMER_ROLE enforces read-only access, no unbounded fact table scans remain. Deploy to Streamlit Community Cloud: configure GitHub repository integration, set Snowflake secrets via Cloud UI (account, user, password, warehouse, database, role), pin Python 3.12 runtime, and verify public URL accessibility. Produce demo artifacts: dashboard README.md with architecture description and screenshots, `secrets.toml.example` credential template, and demo GIF recording of key user flows. Excludes: RAG text-to-SQL interface (dashboard design document Section 9.1), Focus OS iframe embedding (Section 9.2), weekly alerting system (Section 9.3), real-time data feeds (NG1), user authentication (NG2), data editing capabilities (NG3), and predictive ML models (NG4). Entry criterion: PH-13 complete with all four analytical pages (Overview, TTC Deep Dive, Bike Share, Weather Impact) operational against live MARTS data and meeting interaction performance targets. Exit criterion: all 5 dashboard pages render correctly on desktop and mobile viewports, all Section 5.6 performance targets verified, dashboard accessible via public Streamlit Community Cloud URL with zero credential exposure, demo GIF captured, and dashboard README committed to repository. |
