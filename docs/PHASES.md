# Project Phases

Toronto Urban Mobility Analytics implementation roadmap. Phases are sequenced by technical dependency. Each phase produces shippable artifacts that unlock subsequent work.

| ID    | Phase                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ----- | -------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| PH-01 | Repository Governance Foundation [COMPLETE]  | Establish deterministic repository governance including CLAUDE.md enforcement, Claude skills framework (python-writing, dbt-model, skill-creator), Protocol Zero automation, and pre-commit hook infrastructure. Configure GitHub branch protection, required status checks (5 workflows), and CODEOWNER policies. Guarantees code quality invariants before feature development begins. Enables safe multi-contributor scaling with automated compliance gates.                                                                                                                                                                                                                                                                                                                            |
| PH-02 | Snowflake & dbt Environment Setup [COMPLETE] | Provision Snowflake Enterprise trial account with TORONTO_MOBILITY database. Create schema hierarchy (RAW, STAGING, INTERMEDIATE, MARTS, SEEDS) and role-based access control (LOADER_ROLE, TRANSFORMER_ROLE) per security model. Initialize dbt Core 1.8+ project with packages.yml (dbt-utils, dbt-expectations, elementary pinned versions), profiles.yml.example template, and custom macros (generate_schema_name, get_date_spine). Exit criterion: `dbt debug` returns all green checks against Snowflake target.                                                                                                                                                                                                                                                                     |
| PH-03 | Data Ingestion Pipeline [COMPLETE]           | Implement Python 3.12 ingestion scripts under `/scripts` following atomic transaction semantics. Build download.py (fetch from Toronto Open Data Portal), validate.py (schema contract enforcement with fail-fast behavior per Section 4.3 data contracts), transform.py (XLSX to CSV conversion), and load.py (Snowflake COPY INTO with MERGE idempotency). Execute initial load for TTC delays (subway/bus/streetcar), Bike Share ridership, and weather data spanning 2019-present. Exit criterion: RAW schema tables populated with row counts validated against source files within 1% tolerance.                                                                                                                                                                                      |
| PH-04 | Seed Data Layer [COMPLETE]                   | Curate reference data seeds required for downstream transformations. Build ttc_station_mapping.csv (raw station name variants mapped to canonical station_key, resolving historical inconsistencies), ttc_delay_codes.csv (code to description to category mapping), and bike_station_ref.csv (station_id, coordinates, neighborhood from GBFS snapshot). Generate dim_date seed covering 2019-01-01 through 2026-12-31 date spine. Document all seeds in \_seeds.yml with column descriptions. Exit criterion: `dbt seed` executes successfully with all reference data loaded to SEEDS schema.                                                                                                                                                                                            |
| PH-05 | Staging Layer [COMPLETE]                     | Implement staging models as views in `/models/staging` following medallion architecture layer one. Create stg_ttc_subway_delays, stg_ttc_bus_delays, stg_ttc_streetcar_delays, stg_bike_trips (with duration >= 60s filter), and stg_weather_daily. Apply standardized transformations: type casting, column renaming to snake_case, null handling, and surrogate key generation via dbt_utils.generate_surrogate_key(). Define sources in \_sources.yml with freshness checks (warn_after: 45 days, error_after: 90 days). Exit criterion: `dbt build --select staging` passes with all tests green.                                                                                                                                                                                       |
| PH-06 | Intermediate Layer                           | Build intermediate models as ephemeral CTEs in `/models/intermediate` implementing business logic transformations. Create int_ttc_delays_unioned (union all transit modes with mode identifier), int_ttc_delays_enriched (join delay codes, map station names via seed), int_bike_trips_enriched (add station geography, compute duration buckets), int_daily_transit_metrics (pre-aggregate delays to daily grain), and int_daily_bike_metrics (pre-aggregate trips to daily grain). Implement station mapping coverage test targeting >= 99% match rate. Exit criterion: `dbt build --select intermediate` passes with station mapping coverage validated.                                                                                                                                |
| PH-07 | Marts Layer                                  | Construct final analytics-ready models as tables in `/models/marts` per medallion architecture layer three. Build dimension tables: dim_date (generated spine with time intelligence attributes), dim_station (unified TTC + Bike Share with SCD Type 1), dim_weather (daily weather with condition classification), dim_ttc_delay_codes (code lookup with category). Build fact tables: fct_transit_delays (one row per incident, ~1.8M rows), fct_bike_trips (one row per trip, ~30M rows), fct_daily_mobility (cross-modal daily aggregates, ~2,200 rows). Implement comprehensive tests: unique/not_null on all PKs, relationships on all FKs, accepted_values on categoricals. Exit criterion: `dbt build --select marts` passes with 100% PK coverage and all FK relationships valid. |
| PH-08 | Testing & Quality Assurance                  | Implement production-grade test coverage beyond schema tests. Create singular tests in `/tests`: assert_no_negative_delays, assert_bike_trips_reasonable_duration (< 24 hours), assert_no_future_dates, assert_daily_row_count_stability (no > 50% day-over-day drop), assert_station_mapping_coverage. Add dbt_expectations tests for value distributions (delay_minutes between 0-1440, trip_duration bounds). Configure Elementary anomaly detection (volume_anomalies, freshness_anomalies, schema_changes) on all mart models. Execute full regression with `dbt test` achieving 100% pass rate. Exit criterion: Zero test failures, Elementary baseline established, test strategy documented in docs/TESTS.md.                                                                       |
| PH-09 | Documentation & Observability                | Complete model documentation and observability infrastructure. Write column-level descriptions for all models in corresponding \_models.yml files. Generate dbt docs site with `dbt docs generate` and verify lineage graph accuracy. Configure Elementary report generation and integrate with CI pipeline (edr report). Document all architectural decisions, testing strategy, and operational runbooks. Validate query performance against benchmark suite (5 queries < 5 seconds on X-Small warehouse). Exit criterion: `dbt docs generate` succeeds with zero missing descriptions, Elementary dashboard operational, performance benchmarks documented.                                                                                                                              |
| PH-10 | Portfolio Delivery                           | Finalize repository for public portfolio presentation. Complete README.md with architecture diagrams (system overview, data flow, ER diagram), setup instructions (Snowflake provisioning, dbt configuration, initial load), and executable sample queries. Move sample queries to `/analyses` folder with linting compliance. Execute final code review against CLAUDE.md Definition of Done checklist. Verify all CI status checks pass on main branch. Tag v1.0.0 release with changelog. Exit criterion: README complete, CI green, all governance checks pass, repository production-ready for portfolio demonstration.                                                                                                                                                                |
